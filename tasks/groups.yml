---
- name: Delete groups in absent
  group:
    gid: "{{ item.gid|default('') }}"
    name: "{{ item.name|default('') }}"
    state: absent
  with_items: "{{ user_groups }}"
  when: item.state|default('present') != "present"

- name: Create groups
  group:
    gid: "{{ item.gid|default('') }}"
    name: "{{ item.name }}"
    system: "{{ item.system|default('no') }}"
    state: present
  with_items: "{{ user_groups }}"
  when: item.state|default('present') != "present"
